<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="stylesheet" href="fonts/fonts.css"><title data-react-helmet="true">Working with Datastructures | ink! documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://github.com/paritytech/ink/ink-docs/datastructures/hashmap"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Working with Datastructures | ink! documentation"><meta data-react-helmet="true" name="description" content="In this section we want to demonstrate how to work with ink! datastructures."><meta data-react-helmet="true" property="og:description" content="In this section we want to demonstrate how to work with ink! datastructures."><link data-react-helmet="true" rel="icon" href="/ink-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/paritytech/ink/ink-docs/datastructures/hashmap"><link data-react-helmet="true" rel="alternate" href="https://github.com/paritytech/ink/ink-docs/datastructures/hashmap" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/paritytech/ink/ink-docs/datastructures/hashmap" hreflang="x-default"><link rel="stylesheet" href="/ink-docs/assets/css/styles.b96c35fd.css">
<link rel="preload" href="/ink-docs/assets/js/runtime~main.49387dbf.js" as="script">
<link rel="preload" href="/ink-docs/assets/js/main.348d5be9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ink-docs/"><div class="navbar__logo"><img src="/ink-docs/img/logo-black.svg" alt="ink!" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/ink-docs/img/logo-white.svg" alt="ink!" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/paritytech/ink" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>ink! GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/paritytech/ink-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Docs GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleChecked_a04y toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" checked="" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/getting-started/setup">Getting started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/basics/contract-template">Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/macros-attributes">Macros &amp; Attributes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/ink-docs/datastructures/overview">Storage &amp; Data Structures</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ink-docs/datastructures/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ink-docs/datastructures/hashmap">Working with Datastructures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ink-docs/datastructures/spread-packed-layout">Spread vs. Packed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ink-docs/datastructures/opting-out">Opt out of Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ink-docs/datastructures/dynamic-allocation">Dynamic Storage Allocator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ink-docs/datastructures/custom-datastructure">Custom Datastructures</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/examples">Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/cargo-contract-cli">cargo-contract CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/canvas">Canvas Test Network</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/ink-docs/faq">FAQ</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Working with Datastructures</h1></header><p>In this section we want to demonstrate how to work with ink! datastructures.
We will do this using the example of our <code>HashMap</code>, which allows you to store items in a key-value mapping.</p><p>Here is an example of a mapping from a user to a number:</p><div class="codeBlockContainer_J+bg language-rust theme-code-block"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#9a86fd"><span class="token plain">#[ink(storage)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub struct MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    // Store a mapping from AccountIds to a u32</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    my_number_map: ink_storage::collections::HashMap&lt;AccountId, u32&gt;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This means that for a given key, you can store a unique instance of a value type. In this case, each &quot;user&quot; gets their own number, and we can build logic so that only they can modify their own numbers.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="storage-hashmap-api">Storage HashMap API<a class="hash-link" href="#storage-hashmap-api" title="Direct link to heading">â€‹</a></h2><p>You can find the full HashMap API in the <a href="https://paritytech.github.io/ink/ink_storage/collections/hashmap/index.html" target="_blank" rel="noopener noreferrer">crate documentation</a> part of ink!.</p><p>Here are some of the most common functions you might use:</p><div class="codeBlockContainer_J+bg language-rust theme-code-block"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Inserts a key-value pair into the map.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Returns the previous value associated with the same key if any.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// If the map did not have this key present, `None` is returned.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn insert(&amp;mut self, key: K, new_value: V) -&gt; Option&lt;V&gt; {/* --snip-- */}</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Removes the key/value pair from the map associated with the given key.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">///</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// - Returns the removed value if any.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn take&lt;Q&gt;(&amp;mut self, key: &amp;Q) -&gt; Option&lt;V&gt; {/* --snip-- */}</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Returns a shared reference to the value corresponding to the key.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">///</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// The key may be any borrowed form of the map&#x27;s key type,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// but `Hash` and `Eq` on the borrowed form must match those for the key type.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn get&lt;Q&gt;(&amp;self, key: &amp;Q) -&gt; Option&lt;&amp;V&gt; {/* --snip-- */}</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Returns a mutable reference to the value corresponding to the key.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">///</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// The key may be any borrowed form of the map&#x27;s key type,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// but `Hash` and `Eq` on the borrowed form must match those for the key type.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn get_mut&lt;Q&gt;(&amp;mut self, key: &amp;Q) -&gt; Option&lt;&amp;mut V&gt; {/* --snip-- */}</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Returns `true` if there is an entry corresponding to the key in the map.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn contains_key&lt;Q&gt;(&amp;self, key: &amp;Q) -&gt; bool {/* --snip-- */}</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Converts the OccupiedEntry into a mutable reference to the value in the entry</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// with a lifetime bound to the map itself.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn into_mut(self) -&gt; &amp;&#x27;a mut V {/* --snip-- */}</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">/// Gets the given key&#x27;s corresponding entry in the map for in-place manipulation.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">pub fn entry(&amp;mut self, key: K) -&gt; Entry&lt;K, V&gt; {/* --snip-- */}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="initializing-a-hashmap">Initializing a HashMap<a class="hash-link" href="#initializing-a-hashmap" title="Direct link to heading">â€‹</a></h2><p>Not initializing storage before you use it is a common error that can break your smart contract. For each key in a storage value, the value needs to be set before you can use it. To do this, we will create a private function which handles when the value is set and when it is not, and make sure we never work with uninitialized storage.</p><p>So given <code>my_number_map</code>, imagine we wanted the default value for any given key to be <code>0</code>. We can build a function like this:</p><div class="codeBlockContainer_J+bg language-rust theme-code-block"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">use ink_lang as ink;</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">#[ink::contract]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">mod mycontract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(storage)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    pub struct MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        // Store a mapping from AccountIds to a u32</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        my_number_map: ink_storage::collections::HashMap&lt;AccountId, u32&gt;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    impl MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        /// Public function.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        /// Default constructor.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(constructor)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn default() -&gt; Self {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            Self {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                my_number_map: Default::default(),</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        /// Private function.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        /// Returns the number for an AccountId or 0 if it is not set.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        fn my_number_or_zero(&amp;self, of: &amp;AccountId) -&gt; u32 {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            let balance = self.my_number_map.get(of).unwrap_or(&amp;0);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            *balance</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here we see that after we <code>get</code> the reference from <code>my_number_map</code> we call <code>unwrap_or</code> which will either <code>unwrap</code> the reference, <em>or</em> if there is no value, return some known reference. Then, when building functions that interact with this HashMap, you need to always remember to call this function rather than getting the value directly from storage.</p><p>Here is an example:</p><div class="codeBlockContainer_J+bg language-rust theme-code-block"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">use ink_lang as ink;</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">#[ink::contract]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">mod mycontract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(storage)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    pub struct MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        // Store a mapping from AccountIds to a u32</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        my_number_map: ink_storage::collections::HashMap&lt;AccountId, u32&gt;,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    impl MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        // Get the value for a given AccountId</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(message)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn get(&amp;self, of: AccountId) -&gt; u32 {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            self.my_number_or_zero(&amp;of)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        // Get the value for the calling AccountId</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(message)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn get_my_number(&amp;self) -&gt; u32 {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            let caller = self.env().caller();</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            self.my_number_or_zero(&amp;caller)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        // Returns the number for an AccountId or 0 if it is not set.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        fn my_number_or_zero(&amp;self, of: &amp;AccountId) -&gt; u32 {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            let value = self.my_number_map.get(of).unwrap_or(&amp;0);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            *value</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="contract-caller">Contract Caller<a class="hash-link" href="#contract-caller" title="Direct link to heading">â€‹</a></h2><p>As you might have noticed in the example above, we use a special function called <code>self.env().caller()</code>. This function is available throughout the contract logic and will always return to you the contract caller.</p><blockquote><p><strong>NOTE:</strong> The contract caller is not the same as the origin caller. If a user triggers a contract which then calls a subsequent contract, the <code>self.env().caller()</code> in the second contract will be the address of the first contract, not the original user.</p></blockquote><p><code>self.env().caller()</code> can be used in a number of different ways. In the example above, we are basically creating an &quot;access control&quot; layer which only allows users to access their own values. You can also save the contract owner during contract deployment for future references:</p><div class="codeBlockContainer_J+bg language-rust theme-code-block"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">use ink_lang as ink;</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">#[ink::contract]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">mod mycontract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(storage)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    pub struct MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        // Store a contract owner</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        owner: AccountId,</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    impl MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(constructor)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn new() -&gt; Self {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            Self {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                owner: Self::env().caller();</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        /* --snip-- */</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Then you can write permissioned functions which checks that the current caller is the owner of the contract.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="modifying-a-hashmap">Modifying a HashMap<a class="hash-link" href="#modifying-a-hashmap" title="Direct link to heading">â€‹</a></h2><p>Making changes to the value of a HashMap is just as sensitive as getting the value. If you try to modify some value before it has been initialized, your contract will panic!</p><p>But have no fear, we can continue to use the <code>my_number_or_zero</code> function we created to protect us from these situations!</p><div class="codeBlockContainer_J+bg language-rust theme-code-block"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#9a86fd"><span class="token plain">impl MyContract {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /* --snip-- */</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// Set the value for the calling AccountId</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(message)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn set_my_number(&amp;mut self, value: u32) {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        let caller = self.env().caller();</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        self.my_number_map.insert(caller, value);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// Add a value to the existing value for the calling AccountId</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(message)]</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn add_my_number(&amp;mut self, value: u32) {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        let caller = self.env().caller();</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        let my_number = self.my_number_or_zero(&amp;caller);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        self.my_number_map.insert(caller, my_number + value);</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returns the number for an AccountId or 0 if it is not set.</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    fn my_number_or_zero(&amp;self, of: &amp;AccountId) -&gt; u32 {</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        *self.my_number_map.get(of).unwrap_or(&amp;0)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here we have written two kinds of functions which modify a HashMap. One simply inserts the value
directly into storage, with no need to read the value first, and another one modifies the existing
value. Note how we can always <code>insert</code> the value without worry, as that initialized the value in
storage, but before you can get or modify anything, we need to call <code>my_number_or_zero</code> to make
sure we are working with a real value.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="entry-api">Entry API<a class="hash-link" href="#entry-api" title="Direct link to heading">â€‹</a></h2><p>We will not always have an existing value on our contract&#x27;s storage.
We can take advantage of the Rust <code>Option&lt;T&gt;</code> type to help us.
If there&#x27;s no value on the contract storage we will insert a new one; on
the contrary if there is an existing value we will only update it.</p><p>ink! HashMaps expose the well-known
<a href="https://doc.rust-lang.org/beta/std/collections/hash_map/enum.Entry.html" target="_blank" rel="noopener noreferrer"><strong>HashMap Entry API</strong></a>
that we can use to achieve this type of &quot;upsert&quot; behavior:</p><div class="codeBlockContainer_J+bg language-rust theme-code-block"><div class="codeBlockContent_csEI rust"><pre tabindex="0" class="prism-code language-rust codeBlock_rtdJ thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#9a86fd"><span class="token plain">let caller = self.env().caller();</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">self.my_number_map</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .entry(caller)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .and_modify(|old_value| *old_value += by)</span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    .or_insert(by);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ink-docs/edit/master/docs/datastructures/hashmap.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ink-docs/datastructures/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ink-docs/datastructures/spread-packed-layout"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Spread vs. Packed</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#storage-hashmap-api" class="table-of-contents__link toc-highlight">Storage HashMap API</a></li><li><a href="#initializing-a-hashmap" class="table-of-contents__link toc-highlight">Initializing a HashMap</a></li><li><a href="#contract-caller" class="table-of-contents__link toc-highlight">Contract Caller</a></li><li><a href="#modifying-a-hashmap" class="table-of-contents__link toc-highlight">Modifying a HashMap</a></li><li><a href="#entry-api" class="table-of-contents__link toc-highlight">Entry API</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/ink-docs/assets/js/runtime~main.49387dbf.js"></script>
<script src="/ink-docs/assets/js/main.348d5be9.js"></script>
</body>
</html>